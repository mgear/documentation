=========
Email FAQ
=========

This document contains an explanation of the most recurring emailing issues in Odoo. Outgoing emails
(ex: the client has not received the email from the database) will be addressed first, and then,
incoming emails (ex: Responses have not been received from customers in the database).

Outgoing emails
===============

.. _red_envelop:

What to check if the email is not sent?
---------------------------------------

The first indicator showing that the email has not been sent is the red envelope next to the date
and time of the message in the chatter.

.. image:: faq/red-envelop.png
   :align: center
   :alt: Red envelope displayed in chatter.

Unsent emails will also appear in the Odoo email queue. In :ref:`Developer mode <developer-mode>`
this can be accessed by going to :menuselection:`Settings --> Technical Menu --> Emails --> Emails`.
Unsent emails will appear in turquoise; sent emails will appear in grey.

Common error messages
~~~~~~~~~~~~~~~~~~~~~

.. _email_communication/daily_limit_mail:

Reached the daily limit:
************************

.. image:: faq/email-limit.png
   :align: center
   :alt: Warning in Odoo upon email limit reached.

Each email service provider has its own email sending limits. The limits may be daily, hourly,
and sometimes even per minute. This is the same for Odoo, which limits a customer's sending to
prevent Odoo's e-mail servers from being blacklisted.

Here are the default limits for new databases:

- 200 emails/day for Odoo Online and Odoo.sh databases with an active subscription,

- 50 emails/day for one-app free and trial databases,

- In case of migration, the database daily limit might be reset to 50 emails a day.

In case the limit is reached, the following actions can be taken:

- Ask Odoo's support team to increase the daily limit. The Support Team will analyze the situation
  of the database depending on (non-exhaustive list):

  - How many users in the database,
  - Which apps are installed,
  - The bounce rate: the percentage of email addresses that did not receive emails because they were
    returned by a mail server on its way to the final recipient. Contact the `support
    <https://www.odoo.com/help>`_.

- Use a external outgoing email server to be independent of Odoo's mail limit (refer to :doc:`the
  corresponding documentation </applications/general/email_communication/email_servers>`),
- Wait until 11pm UTC for the reset and click on the retry button: The :ref:`Developer mode
  <developer-mode>` must be activated. Then, go to :menuselection:`Settings --> Technical -->
  Emails`

.. warning::
   The daily limit is global to the database and can rise quickly! By default an internal message,
   a notification, a note, etc. counts as an email in the daily limit if it notifies someone.

This can be mitigated by receiving :ref:`notifications in Odoo
<discuss_app/notification_preferences>` instead of by emails.

SMTP Error
**********

It's easy to find out why an email wasn't transmitted successfully by reviewing the Simple Mail
Transport Protocol (SMTP) error messages. :abbr:`SMTP (Simple Mail Transport Protocol)` is a
protocol to describe the email structure and transmit it over the Internet. The error messages
generated by email services are helpful tools to diagnose and troubleshoot email problems.

No Error
********

Odoo is not always capable of providing information for the reason it failed. The different email
providers implement a personalized policy of the bounce emails and it is not always possible for
Odoo to interpret it correctly.

If this a problem on a recurring basis with the same client or the same domain, do not hesitate to
contact `Odoo Support <https://www.odoo.com/help>`_ for help in finding a reason.

.. note::
  In such case, one of the most common reasons is related to :ref:`SPF
  <email_communication/spf_compliant>` and/or :ref:`DKIM <email_communication/DKIM_compliant>`
  configuration.

Why is my email sent late?
**************************

It may happen that an email campaign is scheduled but it is not sent on time. We know that
Odoo uses a delayed job to send emails that are considered as not urgent (Newsletters concept
such as mass mailing, marketing automation, events). The system utility **cron** can be used
to schedule programs to run automatically at predetermined intervals. Odoo uses that policy in order
to avoid cluttering the mail servers and instead prioritizes the communication.

The emails considered urgent (communication from one person to another one such as Sales Orders,
Invoices, Purchase Orders, etc.) are sent directly (immediately).

.. image:: faq/email-scheduled-later.png
   :align: center
   :alt: Email scheduled to be sent later.

By default, the Mass Mailing cron runs every 60 minutes. This can be changed to no less than 5
minutes, but for the reasons mentioned above this isn't recommended. To access this setting go to:
:menuselection:`Settings --> Technical --> Automation --> Scheduled Actions`. The action name is
`Mail: Email Queue Manager`

Incoming emails
===============

When there is an issue with incoming emails, there might not be an indication per se in Odoo. It is
the sending email client who tries to contact a database that will get a bounce-back (most of the
time a `550: mailbox unavailable`).

Emails are not received
-----------------------

Depending on the Odoo platform the database is using:

- **Odoo.sh** users can find their live logs on the folder :file:`~/logs/`.

.. tip::
  The folder :file:`~/logs/` (preferably accessed by the command line) of an Odoo.sh database
  contains a list of files containing the logs of the database. The log files are created everyday
  at 5:00 AM UTC. The two last days are not compressed, while the older ones are, in order to gain
  space. The naming of the files for Today and Yesterday are respectively: :file:`odoo.log` and
  :file:`odoo.log.1`. For the following days, they are named with their dates and compressed. See
  the Odoo.sh documentation about :ref:`logs <odoosh/logs>`. Use the command ``grep`` and ``zgrep``
  (for the compressed ones) to search through the files.

- **Odoo Online** users won't have access to the logs. However `Odoo Support
  <https://www.odoo.com/help>`_ can still be contacted, if there is a recurring issue with the same
  client or domain.

Get help from support
---------------------

In order to get helped efficiently, please provide as much information as possible. Here is a list
of what can be helpful:

- The **EML** or **headers** of the email, is the file format containing all the technical
  information required for an investigation. The documentation from the email provider might provide
  the process on how to get EML/header files. Once the headers of the email are obtained, adding it
  into the Odoo support ticket is the most efficient way for Odoo support to investigate.

  .. seealso::
     - `Gmail documentation
       <https://support.google.com/mail/answer/29436>`_
     - `Outlook documentation
       <https://support.microsoft.com/en-us/office/view-internet-message-headers-in-outlook-cd039382-dc6e-4264-ac74-c048563d212c#tab=Web>`_

- The exact flow that is being followed in order to normally receive those emails in Odoo. Here are
  examples of questions whose answers can be useful:

  - Is this simply a reply from an email going out from Odoo?

  - Is there an incoming email server being used or is email somehow being redirected?

  - Is there an example of an email that has been correctly forwarded?

- Providing answers to the following questions:

  - Is it a generic issue or is it specific to a use case? If yes, which one exactly?

  - Is it working as expected? In case the email is sent using Odoo, the bounce email should reach
    the Odoo database and display the :ref:`red envelope <red_envelop>`.

    .. seealso::
       The bounce system parameter needs to be set in the technical settings in order for the
       database to correctly receive bounce messages. To access this setting go to:
       :menuselection:`Settings --> Technical --> Parameters --> System Parameters`. The parameter
       name is `mail.bounce.alias`.

